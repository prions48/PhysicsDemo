@page "/"
@rendermode InteractiveServer
@using PhysicsDemo.Data.Users

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<MudStack Row>
    <MudNumericField @bind-Value="Mass" Label="Mass" />
    <MudNumericField @bind-Value="TimeStep" Label="Time Step" />
</MudStack>

<MudGrid>
    <MudItem xs="12" sm="12" md="12" lg="12" xl="12">
        <MudChart ChartType="ChartType.Line" ChartSeries="AccData" ChartOptions="_accoptions"></MudChart>
    </MudItem>
    <MudItem xs="12" sm="12" md="12" lg="12" xl="12">
        <MudChart ChartType="ChartType.Line" ChartSeries="VecData" ChartOptions="_vecoptions"></MudChart>
    </MudItem>
    <MudItem xs="12" sm="12" md="12" lg="12" xl="12">
        <MudChart ChartType="ChartType.Line" ChartSeries="PosData" ChartOptions="_posoptions"></MudChart>
    </MudItem>
</MudGrid>

<MudSimpleTable Striped Bordered>
    <thead>
        <tr>
            <th>Time</th>
            <th>Force</th>
            <th>Acceleration</th>
            <th>Velocity</th>
            <th>Position</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>@(GameTime)</td>
            <td>
                <MudNumericField @bind-Value="NewForce" Label="Force" Style="width:200px;" Immediate />
            </td>
            <td colspan="3">
                <MudButton Color="Color.Info" Variant="Variant.Filled" Disabled="!NewForce.HasValue" OnClick="GameStep">Next Step</MudButton>
            </td>
        </tr>
        @foreach (GameStepModel model in Models.OrderByDescending(e => e.Time))
        {
            <tr>
                <td>@model.Time</td>
                <td>@model.Force.ToString()</td>
                <td>@model.Acceleration.ToString("N1")</td>
                <td>@model.Velocity.ToString("N1")</td>
                <td>@model.Position.ToString("N1")</td>
            </tr>
        }
    </tbody>
</MudSimpleTable>
@code {
    private List<GameStepModel> Models { get; set; } = new(){ new GameStepModel() };
    private double Mass { get; set; } = 1;
    private int GameTime { get; set; } = 1;
    private int TimeStep { get; set; } = 1;
    private int? NewForce { get; set; }
    //private AxisChartOptions _axisoptions = new() { MatchBoundsToSize=false};
    private ChartOptions _accoptions = new() { YAxisTicks=1, XAxisLines=true, YAxisLines=true};
    private ChartOptions _vecoptions = new() { YAxisTicks=3, XAxisLines=true, YAxisLines=true};
    private ChartOptions _posoptions = new() { YAxisTicks=10, XAxisLines=true, YAxisLines=true};
    private List<ChartSeries> AccData { get; set; } = new() { new() { Name="Acceleration", Data=[0] }};
    private List<ChartSeries> VecData { get; set; } = new() { new() { Name="Velocity", Data=[0] }};
    private List<ChartSeries> PosData { get; set; } = new() { new() { Name="Position", Data=[0] }};
    private void GameStep()
    {
        if (NewForce == null)
            return;
        Models.Add(new(Models.Last(),NewForce.Value,Mass,TimeStep));
        var arr = AccData.First().Data.ToList();
        arr.Add(Models.Last().Acceleration);
        AccData.First().Data = arr.ToArray();
        arr = VecData.First().Data.ToList();
        arr.Add(Models.Last().Velocity);
        VecData.First().Data = arr.ToArray();
        arr = PosData.First().Data.ToList();
        arr.Add(Models.Last().Position);
        PosData.First().Data = arr.ToArray();
        GameTime += TimeStep;
        NewForce = null;
    }
}



